version: "3.4"
services:
    tunnel:
        image: ngrok/ngrok:latest
        restart: always
        networks:
            - services_network

    db:
        image: postgres:17.0
        restart: always
        networks:
            - services_network

    pubsub:
        image: nats:2.10.24-alpine3.21
        restart: always
        volumes:
            - pubsub_cache:/data
        networks:
            - services_network

    backend:
        build:
            context: ../../services/Backend
            dockerfile: Dockerfile
        restart: always
        networks:
            - services_network
        depends_on:
            - pubsub
            - db

    frontend:
        build:
            context: ../../services/Frontend
            dockerfile: Dockerfile
        restart: always
        networks:
            - services_network

    gateway:
        build:
            context: ../../services/Gateway
            dockerfile: Dockerfile
        restart: always
        networks:
            - services_network

networks:
    services_network:
        external: true

volumes:
    postgres:
        external: false
    pubsub_cache:
        external: false
