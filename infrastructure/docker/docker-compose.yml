version: "3.4"
services:
    db:
        image: postgres
        restart: always
        healthcheck:
            test: [ "CMD-SHELL", "pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}" ]
            interval: 1s
            timeout: 10s
            retries: 3
        networks:
            - services_network

    proxy-service:
        build:
            context: services/Proxy
            dockerfile: Dockerfile
        networks:
            - services_network

    ui-service:
        build:
            context: services/UI
            dockerfile: Dockerfile
        networks:
            - services_network

    authentication-service:
        build:
            context: services/Authentication
            dockerfile: Dockerfile
        networks:
            - services_network

    users-service:
        build:
            context: services/Users
            dockerfile: Dockerfile
        networks:
            - services_network
        depends_on:
            - db

    stitching-service:
        build:
            context: services/Stitching
            dockerfile: Dockerfile
        networks:
            - services_network
        depends_on:
            - users-service

networks:
    services_network:
        external: true

volumes:
    postgres:
        external: false
