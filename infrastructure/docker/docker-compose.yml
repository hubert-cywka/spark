version: "3.4"
services:
    db:
        image: postgres
        restart: always
        networks:
            - services_network

    redis:
        image: redis:6.2-alpine
        restart: always
        volumes:
            - redis_cache:/data
        networks:
            - services_network

    proxy-service:
        build:
            context: services/Proxy
            dockerfile: Dockerfile
        networks:
            - services_network

    ui-service:
        build:
            context: services/UI
            dockerfile: Dockerfile
        networks:
            - services_network

    authentication-service:
        build:
            context: services/Authentication
            dockerfile: Dockerfile
        networks:
            - services_network
        depends_on:
            - redis

    users-service:
        build:
            context: services/Users
            dockerfile: Dockerfile
        networks:
            - services_network
        depends_on:
            - db
            - redis

    stitching-service:
        build:
            context: services/Stitching
            dockerfile: Dockerfile
        networks:
            - services_network
        depends_on:
            - users-service

    mailing-service:
        build:
            context: services/Mailing
            dockerfile: Dockerfile
        networks:
            - services_network
        depends_on:
            - redis

networks:
    services_network:
        external: true

volumes:
    postgres:
        external: false
    redis_cache:
        external: false
