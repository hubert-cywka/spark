version: "3.4"
services:
    db:
        environment:
            POSTGRES_USER: ${DATABASE_USERNAME}
            POSTGRES_PASSWORD: ${DATABASE_PASSWORD}
            POSTGRES_DB: "db"
        ports:
            - "${DATABASE_PORT}:${DATABASE_PORT}"
        volumes:
            - postgres:/var/lib/postgresql/data

    proxy-service:
        ports:
            - "5000:${PROXY_SERVICE_PORT}"
            - "5010:9901"
        environment:
            - AUTHENTICATION_SERVICE_ADDRESS=${AUTHENTICATION_SERVICE_HOST}
            - AUTHENTICATION_SERVICE_PORT=${AUTHENTICATION_SERVICE_PORT}
            - UI_SERVICE_ADDRESS=${UI_SERVICE_HOST}
            - UI_SERVICE_PORT=${UI_SERVICE_PORT}
            - USERS_SERVICE_ADDRESS=${USERS_SERVICE_HOST}
            - USERS_SERVICE_PORT=${USERS_SERVICE_PORT}
            - STITCHING_SERVICE_ADDRESS=${STITCHING_SERVICE_HOST}
            - STITCHING_SERVICE_PORT=${STITCHING_SERVICE_PORT}

    ui-service:
        ports:
            - "5100:${UI_SERVICE_PORT}"
        environment:
            - PORT=${UI_SERVICE_PORT}
            - STATIC_FILES_DIR=${UI_SERVICE_STATIC_FILES_DIR}

    authentication-service:
        ports:
            - "5200:${AUTHENTICATION_SERVICE_PORT}"
        environment:
            - PORT=${AUTHENTICATION_SERVICE_PORT}
            - JWT_SIGNING_SECRET=${AUTHENTICATION_SERVICE_JWT_SIGNING_SECRET}
            - JWT_EXPIRATION_TIME_IN_SECONDS=${AUTHENTICATION_SERVICE_JWT_EXPIRATION_TIME_IN_SECONDS}
            - REFRESH_TOKEN_SIGNING_SECRET=${AUTHENTICATION_SERVICE_REFRESH_TOKEN_SIGNING_SECRET}
            - REFRESH_TOKEN_EXPIRATION_TIME_IN_SECONDS=${AUTHENTICATION_SERVICE_REFRESH_TOKEN_SIGNING_SECRET}
            - DATABASE_PORT=${DATABASE_PORT}
            - DATABASE_USERNAME=${DATABASE_USERNAME}
            - DATABASE_PASSWORD=${DATABASE_PASSWORD}
            - DATABASE_HOST=${DATABASE_HOST}
            - DATABASE_NAME=${AUTHENTICATION_SERVICE_DATABASE_NAME}
            - THROTTLE_LIMIT=${AUTHENTICATION_SERVICE_THROTTLE_LIMIT}
            - THROTTLE_TTL_IN_MS=${AUTHENTICATION_SERVICE_THROTTLE_TTL_IN_MS}

    users-service:
        ports:
            - "5300:${USERS_SERVICE_PORT}"
        environment:
            - PORT=${USERS_SERVICE_PORT}
            - DATABASE_PORT=${DATABASE_PORT}
            - DATABASE_USERNAME=${DATABASE_USERNAME}
            - DATABASE_PASSWORD=${DATABASE_PASSWORD}
            - DATABASE_HOST=${DATABASE_HOST}
            - DATABASE_NAME=${USERS_SERVICE_DATABASE_NAME}

    stitching-service:
        ports:
            - "5400:${STITCHING_SERVICE_PORT}"
        environment:
            - PORT=${STITCHING_SERVICE_PORT}
            - USERS_SERVICE_SUBGRAPH_HOST=${USERS_SERVICE_HOST}
