version: "3.4"
services:
    db:
        environment:
            POSTGRES_USER: "pguser"
            POSTGRES_PASSWORD: "pgpassword"
            POSTGRES_DB: "db"
        ports:
            - "5432:5432"
        volumes:
            - postgres:/var/lib/postgresql/data

    proxy-service:
        ports:
            - "5000:80"
            - "5010:9901"
        environment:
            - AUTHENTICATION_SERVICE_ADDRESS=authentication-service
            - AUTHENTICATION_SERVICE_PORT=80
            - UI_SERVICE_ADDRESS=ui-service
            - UI_SERVICE_PORT=80
            - USERS_SERVICE_ADDRESS=users-service
            - USERS_SERVICE_PORT=80
            - STITCHING_SERVICE_ADDRESS=stitching-service
            - STITCHING_SERVICE_PORT=80

    ui-service:
        ports:
            - "5100:80"
        environment:
            - PORT=80
            - STATIC_FILES_DIR=./static

    authentication-service:
        ports:
            - "5200:80"
        environment:
            - PORT=80
            - JWT_SIGNING_SECRET=jwt-signing-secret
            - JWT_EXPIRATION_TIME_IN_SECONDS=300

    users-service:
        ports:
            - "5300:80"
        environment:
            - PORT=80
            - DATABASE_PORT=5432
            - DATABASE_USERNAME=pguser
            - DATABASE_PASSWORD=pgpassword
            - DATABASE_HOST=db
            - DATABASE_NAME=db_users

    stitching-service:
        ports:
            - "5400:80"
        environment:
            - PORT=80
            - USERS_SERVICE_SUBGRAPH_HOST=users-service
