version: "3.4"
services:
    db:
        environment:
            POSTGRES_USER: ${DATABASE_USERNAME}
            POSTGRES_PASSWORD: ${DATABASE_PASSWORD}
            POSTGRES_DB: "db"
        ports:
            - "${DATABASE_PORT}:${DATABASE_PORT}"
        volumes:
            - postgres:/var/lib/postgresql/data

    redis:
        ports:
            - "${REDIS_PORT}:${REDIS_PORT}"

    proxy-service:
        ports:
            - "${PROXY_SERVICE_EXTERNAL_PORT}:${PROXY_SERVICE_INTERNAL_PORT}"
            - "5010:9901"
        environment:
            - AUTHENTICATION_SERVICE_ADDRESS=${AUTHENTICATION_SERVICE_HOST}
            - AUTHENTICATION_SERVICE_PORT=${AUTHENTICATION_SERVICE_INTERNAL_PORT}
            - UI_SERVICE_ADDRESS=${UI_SERVICE_HOST}
            - UI_SERVICE_PORT=${UI_SERVICE_INTERNAL_PORT}
            - STITCHING_SERVICE_ADDRESS=${STITCHING_SERVICE_HOST}
            - STITCHING_SERVICE_PORT=${STITCHING_SERVICE_INTERNAL_PORT}
            - ALLOWED_ORIGINS=${PROXY_SERVICE_ALLOWED_ORIGINS}

    ui-service:
        ports:
            - "${UI_SERVICE_EXTERNAL_PORT}:${UI_SERVICE_INTERNAL_PORT}"
        environment:
            - PORT=${UI_SERVICE_INTERNAL_PORT}
            - STATIC_FILES_DIR=${UI_SERVICE_STATIC_FILES_DIR}

    authentication-service:
        ports:
            - "${AUTHENTICATION_SERVICE_EXTERNAL_PORT}:${AUTHENTICATION_SERVICE_INTERNAL_PORT}"
        environment:
            - PORT=${AUTHENTICATION_SERVICE_INTERNAL_PORT}
            - JWT_SIGNING_SECRET=${AUTHENTICATION_SERVICE_JWT_SIGNING_SECRET}
            - JWT_EXPIRATION_TIME_IN_SECONDS=${AUTHENTICATION_SERVICE_JWT_EXPIRATION_TIME_IN_SECONDS}
            - REFRESH_TOKEN_SIGNING_SECRET=${AUTHENTICATION_SERVICE_REFRESH_TOKEN_SIGNING_SECRET}
            - REFRESH_TOKEN_EXPIRATION_TIME_IN_SECONDS=${AUTHENTICATION_SERVICE_REFRESH_TOKEN_EXPIRATION_TIME_IN_SECONDS}
            - DATABASE_PORT=${DATABASE_PORT}
            - DATABASE_USERNAME=${DATABASE_USERNAME}
            - DATABASE_PASSWORD=${DATABASE_PASSWORD}
            - DATABASE_HOST=${DATABASE_HOST}
            - DATABASE_NAME=${AUTHENTICATION_SERVICE_DATABASE_NAME}
            - THROTTLE_LIMIT=${AUTHENTICATION_SERVICE_THROTTLE_LIMIT}
            - THROTTLE_TTL_IN_MS=${AUTHENTICATION_SERVICE_THROTTLE_TTL_IN_MS}
            - PUBSUB_HOST=${REDIS_HOST}
            - PUBSUB_PORT=${REDIS_PORT}

    users-service:
        ports:
            - "${USERS_SERVICE_EXTERNAL_PORT}:${USERS_SERVICE_INTERNAL_PORT}"
        environment:
            - PORT=${USERS_SERVICE_INTERNAL_PORT}
            - DATABASE_PORT=${DATABASE_PORT}
            - DATABASE_USERNAME=${DATABASE_USERNAME}
            - DATABASE_PASSWORD=${DATABASE_PASSWORD}
            - DATABASE_HOST=${DATABASE_HOST}
            - DATABASE_NAME=${USERS_SERVICE_DATABASE_NAME}
            - PUBSUB_HOST=${REDIS_HOST}
            - PUBSUB_PORT=${REDIS_PORT}

    stitching-service:
        ports:
            - "${STITCHING_SERVICE_EXTERNAL_PORT}:${STITCHING_SERVICE_INTERNAL_PORT}"
        environment:
            - PORT=${STITCHING_SERVICE_INTERNAL_PORT}
            - USERS_SERVICE_SUBGRAPH_HOST=${USERS_SERVICE_HOST}

    mailing-service:
        ports:
            - "${MAILING_SERVICE_EXTERNAL_PORT}:${MAILING_SERVICE_INTERNAL_PORT}"
        environment:
            - APP_URL=${APP_URL}
            - PORT=${MAILING_SERVICE_INTERNAL_PORT}
            - SENDER_NAME=${MAILING_SERVICE_SENDER_NAME}
            - SENDER_USER=${MAILING_SERVICE_SENDER_USER}
            - SENDER_PASSWORD=${MAILING_SERVICE_SENDER_PASSWORD}
            - SENDER_HOST=${MAILING_SERVICE_SENDER_HOST}
            - SENDER_PORT=${MAILING_SERVICE_SENDER_PORT}
            - DEBUG_MODE=${MAILING_SERVICE_DEBUG_MODE}
            - PUBSUB_HOST=${REDIS_HOST}
            - PUBSUB_PORT=${REDIS_PORT}
