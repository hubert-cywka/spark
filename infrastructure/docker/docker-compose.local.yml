version: "3.4"
services:
    db:
        environment:
            POSTGRES_USER: ${DATABASE_USERNAME}
            POSTGRES_PASSWORD: ${DATABASE_PASSWORD}
            POSTGRES_DB: "db"
        ports:
            - "${DATABASE_PORT}:${DATABASE_PORT}"
        volumes:
            - postgres:/var/lib/postgresql/data

    redis:
        ports:
            - "${PUBSUB_PORT}:${PUBSUB_PORT}"

    gateway:
        ports:
            - "${GATEWAY_EXTERNAL_PORT}:80"
            - "5010:9901"
        environment:
            - BACKEND_ADDRESS=${BACKEND_HOST}
            - BACKEND_PORT=${BACKEND_INTERNAL_PORT}
            - FRONTEND_ADDRESS=${FRONTEND_HOST}
            - FRONTEND_PORT=${FRONTEND_INTERNAL_PORT}
            - ALLOWED_ORIGINS=${GATEWAY_ALLOWED_ORIGINS}

    frontend:
        ports:
            - "${FRONTEND_EXTERNAL_PORT}:${FRONTEND_INTERNAL_PORT}"
        environment:
            - PORT=${FRONTEND_INTERNAL_PORT}
            - STATIC_FILES_DIR=${FRONTEND_STATIC_FILES_DIR}

    backend:
        ports:
            - "${BACKEND_EXTERNAL_PORT}:${BACKEND_INTERNAL_PORT}"
        environment:
            - APP_URL=${APP_URL}

            - PUBSUB_HOST=${PUBSUB_HOST}
            - PUBSUB_PORT=${PUBSUB_PORT}

            - DATABASE_PORT=${DATABASE_PORT}
            - DATABASE_USERNAME=${DATABASE_USERNAME}
            - DATABASE_PASSWORD=${DATABASE_PASSWORD}
            - DATABASE_HOST=${DATABASE_HOST}

            - PORT=${BACKEND_INTERNAL_PORT}
            - JWT_SIGNING_SECRET=${JWT_SIGNING_SECRET}
            - JWT_EXPIRATION_TIME_IN_SECONDS=${JWT_EXPIRATION_TIME_IN_SECONDS}
            - REFRESH_TOKEN_SIGNING_SECRET=${REFRESH_TOKEN_SIGNING_SECRET}
            - REFRESH_TOKEN_EXPIRATION_TIME_IN_SECONDS=${REFRESH_TOKEN_EXPIRATION_TIME_IN_SECONDS}

            - AUTH_DATABASE_NAME=${AUTH_DATABASE_NAME}
            - AUTH_THROTTLE_LIMIT=${AUTH_THROTTLE_LIMIT}
            - AUTH_THROTTLE_TTL_IN_MS=${AUTH_THROTTLE_TTL_IN_MS}

            - USERS_DATABASE_NAME=${USERS_DATABASE_NAME}

            - MAIL_SENDER_NAME=${MAIL_SENDER_NAME}
            - MAIL_SENDER_USER=${MAIL_SENDER_USER}
            - MAIL_SENDER_PASSWORD=${MAIL_SENDER_PASSWORD}
            - MAIL_SENDER_HOST=${MAIL_SENDER_HOST}
            - MAIL_SENDER_PORT=${MAIL_SENDER_PORT}
            - MAIL_DEBUG_MODE=${MAIL_DEBUG_MODE}
